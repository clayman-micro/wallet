---
language: python
python:
  - "3.7-dev"

sudo: required

services:
  - docker

addons:
  apt:
    packages:
    - python-pip
  sonarcloud:
    organization: clayman74-github

jobs:
  include:
    - stage: "test"
      name: "Test"
      script:
        - pip install tox
        - tox -- --pg-image=postgres:10-alpine
        - sonar-scanner
    - stage: "build"
      name: "Build"
      if: tag is present
      script:
        - make build-image
        - make publish-image
