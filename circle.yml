machine:
  timezone:
    Asia/Yekaterinburg

  python:
    version: 3.4.2

test:
  override:
    - touch testing.yml
    - echo '---' >> testing.yml
    - echo 'secret_key\: top-secret' >> testing.yml
    - echo 'token_expires\: 300' >> testing.yml
    - echo 'sqlalchemy_dsn\: postgres://ubuntu@localhost:5432/circle_test' >> testing.yml

    - python setup.py test -a "-vv --cov wallet --cov-report html --cov-report xml tests"

general:
  artifacts:
    - "dist/"

deployment:
  production:
    branch: master
    commands:
      - deactivate
      - ~/.pyenv/versions/2.7/bin/pip install ansible

      - touch inventory
      - echo "[wallet]" > inventory
      - echo "essential ansible_ssh_host=clayman.pro ansible_ssh_user=clayman" >> inventory
      - echo "[wallet:vars]" >> inventory
      - echo "project_branch=master" >> inventory
      - echo "project_user=clayman" >> inventory

      - ~/.pyenv/versions/2.7/bin/ansible-playbook -i inventory playbooks/deploy.yml
