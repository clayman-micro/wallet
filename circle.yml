machine:
  timezone:
    Asia/Yekaterinburg

  python:
    version: 3.4.2

test:
  override:
    - DB_USER=ubuntu DB_NAME=circle_test python setup.py test -a "-vv --cov wallet --cov-report html --cov-report xml tests"

general:
  artifacts:
    - "dist/"
    - "tests/coverage/"

deployment:
  production:
    branch: master
    commands:
      - deactivate
      - ~/.pyenv/versions/2.7/bin/pip install ansible

      - touch inventory
      - echo "[wallet]" > inventory
      - echo "essential ansible_ssh_host=clayman.pro ansible_ssh_user=clayman" >> inventory
      - echo "[wallet:vars]" >> inventory
      - echo "project_branch=master" >> inventory
      - echo "project_user=clayman" >> inventory

      - ~/.pyenv/versions/2.7/bin/ansible-playbook -i inventory playbooks/deploy.yml
